<!DOCTYPE html>
<html lang="en">

<head>
  <title>GraymanRe</title>
  <meta name='description' content='Personal Portfolio & Project Website'>
  <link rel="canonical" href="/">
  <link rel="alternate" type="application/rss+xml" title="GraymanRe" href="/feed.xml">
  <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">

  <!-- Ionicons -->
  <link href="https://unpkg.com/ionicons@4.2.2/dist/css/ionicons.min.css" rel="stylesheet">
  <link href="/css/main.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    $(function() {
      $("#header-content").load("https://graymanre.github.io/header.html");
      $("#footer-content").load("https://graymanre.github.io/footer.html");
    });
  </script>
</head>

<body class="is-in">
  <!-- begin header -->
  <header class="header">
    <div id="header-content">
  </header>
  <!-- end header -->

  <!-- begin search -->
  <div class="search">
    <div class="container">
      <div class="row">
        <div class="col col-12">
          <div class="search__box">
            <div class="search__group">
              <div class="search__close">
                <i class="ion ion-md-close"></i>
              </div>
              <label for="js-search-input" class="screen-reader-text">Search for Post</label>
              <input type="text" id="js-search-input" class="search__text" autocomplete="off"
                placeholder="Type to search...">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row search-results-list" id="js-results-container"></div>
    </div>
  </div>
  <!-- end search -->

  <!-- Start of custom content -->
  <main class="content" aria-label="Content">
    <div class="post-head">
      <div class="container">
        <div class="row">
          <div class="col col-2"></div>
          <div class="col col-8 col-t-12">
            <div class="post-head__box">
              <div class="post__meta">
                <span class="post__minutes">8 min read <time class="post__date" datetime="2024-06-26T00:00:00+02:00">June
                    26, 2024</time>
                </span>
              </div>
              <h2 class="post__title">03 - Magic 8 Ball - Flare-On9 Writeup</h2>
              <div class="post__bottom">
                <div class="post__author">
                  <a href="/contact/" aria-label="GraymanRe"><img class="post__author-image"
                      src="/img/logo.png" alt="GraymanRe's Picture"></a>
                </div>
                <div class="post__bottom-meta">
                  <a href="/contact/" class="post__author-link">GraymanRe</a>
                  <span>in</span>
                  <span class="post-tags">
                    <a href="/ctf" class="article__tag">CTF Writeups</a>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- begin post -->
    <div class="container">
      <article class="post animate">
        <div class="post__content">
          <h3 id="post__content__title">Shall we play another game?</h3>
          <div class="language-plaintext highlighter-rouge">
            <div class="highlight">
              <pre
                class="highlight"><code>I said you wouldn't win that last one. I lied. The last challenge was basically a captcha. Now the real work begins. Shall we play another game?</code></pre>
            </div>
          </div>
          <h3 id="post__content__title2">Challenge Writeup</h3>
          <p>
            When launching the application you will see two instructions:
            <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                  <pre
                    class="highlight"><code>1. Press arrow keys to shake the ball.<br>2. Start typing your question (max. 75 characters)</code></pre>
                </div>
            </div>
            The given instructions indicate that a combination of arrow keys and a string would be needed in order to crack the challenge.
            We load the binary into IDA and set out to understand how it works. 
            <br>
            The main entrypoint of the application is the <span id="inline-code">WinMain</span> function which will call a single function. Analyzing this
            function it appears to configure the basics in order to start the program. Based on the imports table we see that a substantial amount of functions
            have the <span id="inline-code">SDL</span> prefix. Some research shows that the Simple DirectMedia Layer library is used by this application.
            <div class="language-plaintext highlighter-rouge">
                <div class="highlight">
                    <pre class="highlight"><code>Simple DirectMedia Layer is a cross-platform development library designed to provide low level access to audio, keyboard, mouse, joystick, and graphics hardware via OpenGL/Direct3D/Metal/Vulkan. It is used by video playback software, emulators, and popular games including Valve's award winning catalog and many Humble Bundle games.</code></pre>
                </div>
            </div>
            
            From the documentation we gleam that the application's <span id="inline-code">main</span> function will be redefined/replaced by <span id="inline-code">SDL_SetMainReady</span>.
            Furthermore, we can assume that keyboard input will be used to, which is handled using the function <span id="inline-code">SDL_PollEvent</span>.
            
            If we focus our initial efforts on <span id="inline-code">SDL_SetMainReady</span>, we see that it will call the function at <span id="inline-code">Magic8Ball+0x27A0</span>,
            before calling other functions which all seem responsible for cleaning up the process. Therefore, we will refocus on the execution flow within
            the <span id="inline-code">Magic8Ball+0x27A</span> function.
            <br>
            Analyzing the <span id="inline-code">Magic8Ball+0x27A</span> function brings us initially to a call at <span id="inline-code">Magic8Ball+0x281D</span>. This funcion appears
            to further setup the application, reads fonts, and additionally sets a buffer starting at <span id="inline-code">edi+5c</span> to the value of
            <span id="inline-code">6D6D69676C662065702067613F736C</span>. When we decode this hex string, we find out it resolves to <span id="inline-code">gimme flag pls?</span>. We 
            assume that this string that this string might be of importance later on. 
            <br>
            As the process uses SDL, it will use <span id="inline-code">PollEvents</span> to handle any keyboard input and other such events. The call at
            <span id="inline-code">Magic8Ball+287D</span> seems to call the function that will handle the<span id="inline-code">PollEvents</span>.
            As such, the assumption is made that the call at<span id="inline-code">Magic8Ball+2888</span> contains the logic to get the flag.
            <br>
            As it was not immediately clear what th eusage of this function was, a couple of breakpoints were set on the multiple
            if-statements within this function. Because the<span id="inline-code">SDL_PollEvents</span> function will handle _all_ events, it should be
            possible to deduce when the user-input will be handled. After some trial-and-error, it appeared that setting a breakpoint
            on<span id="inline-code">Magic8Ball+26B9</span>, before execution, then entering the question and pressing "ENTER" would result in the execution flow
            ending up here. From hereonwards, we see a nested<span id="inline-code">if</span> structure, wihch should result eventually in a call to<span id="inline-code">strncmp</span>
            and a subsequent call to<span id="inline-code">Magic8Ball+1A10</span>.
            <br>
            For every<span id="inline-code">if-statement</span>, it is checked if the value in<span id="inline-code">[ecx+x]</span> where<span id="inline-code">x</span> is an incrementing number starting at 0,
            is equal to a certain hex-value. Checking all the<span id="inline-code">if-statements</span> it became obvious that there were only 4 unique
            hex-values that were considered 'valid' input. These values corresponded to the letters<span id="inline-code">L, R, U, D</span>, likely for 
            "left, right, up & down". With this new insight we could reverse what the expected pattern is and identified it to
            be corresponding to:<span id="inline-code">LLURULDUL</span>. If this pattern was hit, the user would then be prompted to input a "question".
            Following execution flow, we see that the user's input is subsequently compared using<span id="inline-code">strncmp</span> against the earlier
            identified hardcoded string "gimme flag pls?". 
            <br>
            Thus, by inputting the arrow key combination "LLURULDUL" and asking the question "gimme flag pls?" we obtain the
            flag for this challenge: <span id="inline-code">U_cRackeD_th1$_maG1cBaLL_!!_@flare-on.com</span>. And with that, 
            we have completed the third Flare-On challenge!
          </p>
        </div>
      </article>
    </div>
  </main>
  <!-- End of custom content -->

  <div class="top" title="Top"><i class="ion ion-ios-arrow-up"></i></div>
  <!-- begin footer-widgets -->
  <section class="footer-widgets">
    <div class="container">
      <div class="row">
        <div class="col col-4 col-d-6 col-t-12">
          <div class="widget widget-tag-cloud">
            <div class="widget__head">
              <h3 class="widget__title">Explore Tags</h3>
            </div>
            <div class="tag__cloud">
              <a href="/rev/" class="set-1">Reverse Engineering</a>
              <a href="/project/" class="set-1">Projects</a>
              <a href="/ctf" class="set-1">CTF Writeups</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- end footer-widgets -->

  <!-- begin footer -->
  <footer class="footer">
    <div id="footer-content"></div>
  </footer>
  <!-- end footer -->
  <script src="/js/vendors/jquery-3.5.1.min.js"></script>
  <script src="/js/vendors/simple-jekyll-search.min.js"></script>
  <script src="/js/vendors/jquery.fitvids.js"></script>
  <script src="/js/vendors/lazyload.min.js"></script>
  <script src="/js/vendors/transition.js"></script>
  <script src="/js/vendors/zoom.min.js"></script>
  <script src="/js/common.js"></script>
  <script>
    var base_url = "",
      pagination_next_url = base_url + '/page2',
      pagination_next_page_number = '',
      pagination_available_pages_number = '1';
  </script>
</body>

</html>