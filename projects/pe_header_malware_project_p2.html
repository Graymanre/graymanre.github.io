<!DOCTYPE html>
<html lang="en">

<head>
    <meta property="og:title" content="GraymanRe - Understanding PE headers using malware" />
    <meta property="og:description" content="Understanding PE headers using malware" />
    <meta property="og:image" content="https://graymanre.github.io" />
    <meta property="og:url" content="https://graymanre.github.io/" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="@grayman_re" />

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>GraymanRe - Understanding PE headers using malware</title>

    <link rel="canonical" href="https://graymanre.github.io/">
    <link rel="alternate" type="application/rss+xml" title="GraymanRe" href="../feed.xml">
    <link rel="icon" type="image/x-icon" href="../img/favicon.ico">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">

    <!-- Ionicons -->
    <link href="https://unpkg.com/ionicons@4.2.2/dist/css/ionicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/prism.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#header-content').load('https://graymanre.github.io/header.html', function () {
                $.getScript('/js/common.js');
            });
            $("#footer-content").load("https://graymanre.github.io/footer.html");
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4VZEKGVZPK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-4VZEKGVZPK');
    </script>
</head>

<body class="is-in">
    <!-- begin header -->
    <header class="header">
        <div id="header-content"></div>
    </header>
    <!-- end header -->
    <!-- begin search -->
    <div class="search">
        <div class="container">
            <div class="row">
                <div class="col col-12">
                    <div class="search__box">
                        <div class="search__group">
                            <div class="search__close">
                                <i class="ion ion-md-close"></i>
                            </div>
                            <label for="js-search-input" class="screen-reader-text">Search for Post</label>
                            <input type="text" id="js-search-input" class="search__text" autocomplete="off" placeholder="Type to search...">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row search-results-list" id="js-results-container"></div>
        </div>
    </div>
    <!-- end search -->
    <!-- start of custom content -->
    <main class="content" aria-label="Content">
        <div class="post-head">
            <div class="container">
                <div class="row">
                    <div class="col col-2"></div>
                    <div class="col col-8 col-t-12">
                        <div class="post-head__box">
                            <div class="post__meta">
                                <span id="time"></span> min read <time class="post__date" datetime="2024-07-12T00:00:00+02:00">- 12 July 2024</time>
                            </div>
                            <h2 class="post__title">Understanding PE headers using malware</h2>
                            <div class="post__bottom">
                                <div class="post__author">
                                    <a href="../contact/" aria-label="GraymanRe">
                                        <img class="post__author-image"
                                             src="../img/logo.webp" alt="GraymanRe's Picture">
                                    </a>
                                </div>
                                <div class="post__bottom-meta">
                                    <a href="../contact/" class="post__author-link">GraymanRe</a>
                                    <span>in</span>
                                    <span class="post-tags">
                                        <a href="../projects" class="post__tag">Projects</a>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- begin post -->
        <div class="container">
            <article id="article" class="post animate">
                <div class="post__content">
                    <h3 id="post__content__title">Introduction</h3>
                    <p>
                        This blog post is the second part of a 2-series blog post which aims to highlight my understanding of the headers within a PE-COFF
                        file and how they can be extracted as well as a demonstration of how the headers are (ab)used in malware. 
                        <br>
                        To demonstrate both software development skills and the technical understanding of the PE-COFF file headers, a C++ tool will be
                        developed, aptly named PEDetect.
                        <br>
                        PEDetect is a self-made attempt at mirroring the features and capabilities of multiple well-known industry tools by aiming to
                        develop an advanced understanding of the PE-COFF file structure. With PEDetect the aim is to understand how these tools work, 
                        and more importantly how the PE-COFF and other headers in executables are structured. This understanding should lead to an 
                        increase in knowledge about the information that these headers contain and how they can be extracted and correlated. 
                        <br><br>
                        In this second part, we will aim at answering questions that malware analysts try to answer when analyzing malicious malware
                        samples.
                        <table>
                            <thead>
                                <td>
                                    <tr>Operational, Attribution and Context focused questions</tr>
                                </td>
                            </thead>
                            <tbody>
                                <td>
                                    <tr>Can we detect if the entry point is "normal" or suspicious (identify stubs, loaders and abnormal startup routines)</tr>
                                    <tr>What compiler, toolchain and language was used?</tr>
                                    <tr>What external functionality does the malware rely on?</tr>
                                    <tr>When was the binary built and can this be correlated?</tr>
                                    <tr>Are there indicators of packing, obfuscation or tampering?</tr>
                                    <tr>What is the intended runtime environment and does it use/disable modern exploit mitigation flags?</tr>
                                    <tr>What resources does the binary embed?</tr>
                                </td>
                            </tbody>
                        </table>
                    </p>
                    <h3 id="post__content__title">Usage of PEDetect</h3>
                    <p>
                        For those, that would like to use PEDetect, I recommend following the steps below to compile the project and run it against 
                        executables. It is recommend that you use Visual Studio (for example VS Pro 2022) to build the project and execute the compiled
                        binary using the Visual Studio build tools. The output of this operation should be a working executable which takes one (1) 
                        command line argument: the PE-file whose headers should be analyzed.
                    </p>

                    <h3 id="post__content__title">Table of Contents</h3>
                    <div class="nav">
                        <a href="#section1" class="btn">1. Identifying Normal or Suspcious Entry Points</a><br>
                        <a href="#section2" class="btn">2. Compiler, Toolchain and Language Usage</a><br>
                        <a href="#section3" class="btn">3. External Functionality Included in the Malware</a><br>
                        <a href="#section4" class="btn">4. Binary Built Timestamp Artifacts</a><br>
                        <a href="#section5" class="btn">5. Indicators of Packing, Obfuscation and/or Tampering</a><br>
                        <a href="#section6" class="btn">6. Intended Runtime Environment and Exploit Mitigation</a><br>
                        <a href="#section7" class="btn">7. Embedded Resources</a><br>
                    </div>

                    <h3 id="section1">Identifying Normal or Suspcious Entry Points</h3>
                    <p>
                        One of the ways that malware developers can hinder malware analysis and reverse engineering efforts is by using stubs, loaders
                        or abnormal startup routines that alter the way malware is executed. In normal software we expect to find the offset to the 
                        PE header in the DOS header. Subsequently, we also expect the Optional Header to contain the <span id="inline-code">AddressOfEntryPoint</span>
                        and a corresponding section within the section headers which holds the entry point. By finding these values and ensuring they are
                        aligned, we can find out if stubs, loaders or abnormal startup routines are used.
                    </p>

                    <h3 id="section2">Compiler, Toolchain and Language Usage</h3>
                    <p>
                        The RICH header, the Optional Header as well as 
                    </p>

                    <h3 id="section3">External Functionality Included in the Malware</h3>
                    <p>

                    </p>

                    <h3 id="section4">Binary Built Timestamp Artifacts</h3>
                    <p>

                    </p>

                    <h3 id="section5">Indicators of Packing, Obfuscation and/or Tampering</h3>
                    <p>

                    </p>

                    <h3 id="section6">Intended Runtime Environment and Exploit Mitigation</h3>
                    <p>

                    </p>

                    <h3 id="section7">Embedded Resources</h3>
                    <p>

                    </p>
                </div>
            </article>
        </div>
        <!-- end post -->
    </main>
    <!-- end of custom content -->

    <div class="top" title="Top"><i class="ion ion-ios-arrow-up"></i></div>
    <!-- begin footer-widgets -->
    <section class="footer-widgets">
        <div class="container">
            <div class="row">
                <div class="col col-4 col-d-6 col-t-12">
                    <div class="widget widget-tag-cloud">
                        <div class="widget__head">
                            <h3 class="widget__title">Explore Tags</h3>
                        </div>
                        <div class="tag__cloud">
                            <a href="../re" class="set-1">Reverse Engineering</a>
                            <a href="../projects" class="set-1">Projects</a>
                            <a href="../ctf/" class="set-5">CTF Writeups</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- end footer-widgets -->
    <!-- begin footer -->
    <footer class="footer">
        <div id="footer-content"></div>
    </footer>
    <!-- end footer -->
    <script src="../js/vendors/jquery-3.5.1.min.js"></script>
    <script src="../js/vendors/simple-jekyll-search.min.js"></script>
    <script src="../js/vendors/jquery.fitvids.js"></script>
    <script src="../js/vendors/lazyload.min.js"></script>
    <script src="../js/vendors/transition.js"></script>
    <script src="../js/vendors/zoom.min.js"></script>
    <script src="../js/vendors/prism.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/readingtime.js"></script>

    <script>
        var base_url = "",
            pagination_next_url = base_url + '/page2',
            pagination_next_page_number = '',
            pagination_available_pages_number = '1';
    </script>
</body>

</html>